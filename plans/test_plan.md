# テスト計画書

## 1. 目的
本計画は、サイクリングルート検索アプリケーションの包括的な動作確認を行い、機能要件および非機能要件を満たしていることを検証することを目的とする。

## 2. テスト範囲
- バックエンドAPIの機能確認（正常系、異常系、境界値）
- システム全体のパフォーマンステスト
- フロントエンドのUI/UX動作確認（異なる環境・設定）

## 3. テスト戦略
### 3.1 自動化テスト (Node.jsスクリプト)
以下の項目は、再現性と効率性を重視し、Node.jsスクリプトを用いてAPIレベルで自動的に検証する。

**対象機能:**
- ルート検索ロジック（開始・終了・経由地点の組み合わせ）
- エラーハンドリング（無効な入力、サーバーエラー）
- 境界値テスト（距離、地点数）
- パフォーマンステスト（同時アクセス、連続アクセス）

**ツール:**
- `tests/integration_scenarios.js`: 機能テスト用スクリプト
- `tests/performance_test.js`: 負荷テスト用スクリプト
- ランタイム: Node.js (標準ライブラリ + `fetch` API)

### 3.2 手動確認・シミュレーション
以下の項目は、実際のブラウザ操作や環境設定が必要なため、手動確認手順書に基づいて実施する。また、一部の環境依存項目（デバイス差分など）はChrome DevToolsなどのシミュレーション機能を活用する。

**対象:**
- UI操作によるルート指定フロー
- レスポンシブデザインの確認
- ネットワーク状態の変化（オフライン、低速回線）
- ブラウザ設定の違い（言語、タイムゾーンなど）

## 4. 詳細テスト項目と実施方法

### 4.1 機能テスト (API & Integration)

| ID | テストカテゴリ | 内容 | 実施方法 |
|----|----------------|------|----------|
| F-01 | 基本ルート検索 | 開始・終了地点のパターン確認（5パターン×5パターン） | 自動スクリプト |
| F-02 | 同一地点 | 開始地点と終了地点が同じ場合の挙動 | 自動スクリプト |
| F-03 | 経由地点（おすすめ）| おすすめ経由地点を選択した検索 | 自動スクリプト |
| F-04 | 経由地点（指定） | 任意の経由地点を指定した検索 | 自動スクリプト |
| F-05 | 全指定 | 開始・終了・経由すべてを指定 | 自動スクリプト |
| F-06 | 異常系（存在しない）| 存在しない地点座標の指定 | 自動スクリプト |
| F-07 | 境界値（近距離） | 極端に近い地点間 | 自動スクリプト |
| F-08 | 境界値（遠距離） | 極端に遠い地点間 | 自動スクリプト |
| F-09 | 境界値（経由多） | 許容上限を超える経由地点数 | 自動スクリプト |
| F-10 | アルゴリズム（標高）| 獲得標高を優先した検索結果の確認 | 自動スクリプト |
| F-11 | アルゴリズム（距離）| 走行距離を優先した検索結果の確認 | 自動スクリプト |
| F-12 | 不正リクエスト | JSON形式エラー、必須パラメータ欠落 | 自動スクリプト |

### 4.2 非機能テスト (Performance & Reliability)

| ID | テストカテゴリ | 内容 | 実施方法 |
|----|----------------|------|----------|
| P-01 | 同時接続負荷 | 多数の同時リクエスト実行時の応答時間・エラー率<br>- 同時接続数: 10, 50, 100<br>- 期待値: エラー率1%未満、95パーセンタイル応答時間 < 2秒 | 負荷スクリプト |
| P-02 | 連続稼働（耐久） | 長時間の連続リクエストによるリソース枯渇確認<br>- 実行時間: 1分間継続（簡易）<br>- 間隔: 100ms | 負荷スクリプト |
| P-03 | レスポンス一貫性 | 同一リクエストの繰り返しによる応答時間のばらつき<br>- 試行回数: 50回 | 負荷スクリプト |
| P-04 | キャッシュ効果 | キャッシュ有効/無効時の応答時間比較 | 負荷スクリプト |

### 4.3 フロントエンド環境テスト (Environment & Context)

| ID | テストカテゴリ | 内容 | 実施方法 |
|----|----------------|------|----------|
| E-01 | ネットワーク障害 | オフライン時のUI挙動、再接続時の復帰処理 | 手動(DevTools) |
| E-02 | サーバー負荷 | タイムアウト時のエラー表示、リトライ動作 | 手動(遅延模擬) |
| E-03 | 重複リクエスト | ボタン連打時の制御（ローディング中のボタン無効化） | 手動 |
| E-04 | キャンセル | 検索中のキャンセル操作（AbortControllerの動作） | 手動 |
| E-05 | デバイス差異 | PC, Tablet, Mobileの画面サイズ・解像度 | 手動(DevTools) |
| E-06 | OS/ブラウザ | UA偽装による挙動確認、固有のCSSバグ有無 | 手動(DevTools) |
| E-07 | 言語設定 | `Accept-Language` ヘッダー変更時の表示 | 手動(設定変更) |
| E-08 | タイムゾーン/地域 | システム時間・地域設定変更時の表示 | 手動 |
| E-09 | アクセシビリティ | キーボード操作、スクリーンリーダー対応、色覚多様性 | 手動 |
| E-10 | セキュリティ | CORS設定、XSS対策（入力値エスケープ）、HTTPS強制 | 自動/手動 |

## 5. テストデータ準備
- **正常系データ:**
  - `data/test_routes.json`: 既知の有効な開始・終了座標セット（東京近郊、山岳地帯など）
- **異常系データ:**
  - `data/invalid_inputs.json`: 範囲外座標、不正フォーマットJSON、SQLインジェクション風文字列

## 6. ディレクトリ構成予定
```
/
├── plans/
│   ├── test_plan.md          # 本ファイル
│   └── frontend_manual_test.md # フロントエンド手動テスト手順書
└── tests/
    ├── integration_scenarios.js # 機能テストスクリプト
    ├── performance_test.js      # 負荷テストスクリプト
    └── data/
        ├── test_routes.json     # テスト用座標データ
        └── invalid_inputs.json  # 異常系データ
```
